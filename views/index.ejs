<!DOCTYPE html>
<html>
  <head>
    <title>Restaurants</title>
    <style type="text/css">
      table{
          border: 2px solid rgb(85, 85, 206);
          background-color: aliceblue;
          width: 40em;
      }
      tr, td{
        border-top :2px solid rgb(85, 85, 206);
        padding-left: 3em;
        padding-right: 3em;
        font-family: Arial, Helvetica, sans-serif;
        color: rgb(85, 85, 206);
      }
      body {
        background-color: rgb(205, 205, 255);
      }
      .flex
      {
        display:flex;
        flex-direction: row;
        width: 50%;
        margin: auto;
      }
      button
      {
        background-color: rgb(85, 85, 206);
        border: 0;
        color: aliceblue;
        margin-right: 0.5em;
        margin-left: 0.5em;
        font-family: Arial, Helvetica, sans-serif;
        font-size: medium;
      }
  </style>
  </head>
  <body>
    <div class = "flex">
    <select id="filterList" onchange="dropBoxChange()">
      <option value="1">-- No Filter -- </option>
      <option value="2">Country</option>
      <option value="3">City</option>
      <option value="4">Cuisine</option>
  </select>
  <select id="List"> 
    <option>-- No Filter -- </option>
  </select>
  <button id="apply" onclick="applyFilter()"> Apply Filter </button>
  <button id="clear" disabled onclick="clearFilter()">Clear Filter</button>
    </div>
    <div class = "flex">
  <p> 
    <table>
      <thead>
          <tr>
              <th>Name</th>
              <th>Country</th>
              <th>City </th>
              <th>Cuisine Type </th>
          </tr>
      </thead>
      <tbody id="bodyTable">

      </tbody>
  </table>
</p>
</div>
<div class = "flex">
<p>
  <button id="previous"> Previous</button>
  <label id="countResults">Display Info Here</label>
  <!--Need to Code Dropdown funciton that stores the number-->
  <button id="next">Next>></button>
</p>
<p>
  Rows to Display:
  <select id="tableList" value = 5>
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="25">25</option>
    <option value="50">50</option>
</p>
</div>
  </body>
  <script type="text/javascript"></script>
  <script type="text/javascript">
    let table = document.querySelector('table tbody');
    let pageNumber = 0;
    let take = 3;
    //Need to figure out how to do this with ejs i guess.
    function dropBoxChange()
    {
      let checkedFilter = 
      document.querySelector('#filterList option:checked');
      let List = document.getElementById('List');
      List.innerHTML="";
      '<% for(let i = 0; i < result.length; i++)   { %>'
          if(checkedFilter.value=="2")
          List.innerHTML+=`<option value><%=result[i].country%></option>`;
          else if(checkedFilter.value=="3")
          List.innerHTML+=`<option><%=result[i].city%></option>`;
          else if(checkedFilter.value=="4")
          List.innerHTML+=`<option><%=result[i].cuisine%></option>`;
          '<% } %>' 
          console.log(checkedFilter.value)
     }

    function getData() {
        fetch(`/users?page=${pageNumber}&take=${take}`)
        .then(response => response.json())
        .then(data => {
            table.innerHTML = "";

            for(let i = 0; i < data.length; i++) {
                table.innerHTML += `
                    <tr>
                        <td>${data[i].name}</td>
                        <td>${data[i].country}</td>
                        <td>${data[i].city}</td>
                        <td>${data[i].cuisine}</td>
                    </tr>
                `;
            }
        });
    }

    function applyFilter()
    {
      let checkedFilter = 
      document.querySelector('#filterList option:checked');
      let listFilter = document.querySelector('#List option:checked');

      if (checkedFilter.value == "1" || listFilter.value == null)
        alert("No filter selected");
      else 
      {
        document.getElementById("clear").disabled = false;
        //code that will apply the filter here
      }
    }
    function clearFilter()
    {
      document.getElementById("clear").disabled = true;
      document.getElementById("filterList").value = 1;
      document.getElementById("List").value = 1;
    }

    getData();
    
    document.querySelector("#previous").addEventListener("click", event => {
        // this needs to decrement the page number and re-fetch the data
        if(pageNumber != 0)
          pageNumber--;
        getData();
    });

    document.querySelector("#next").addEventListener("click", event => {
        // this needs to increment the page number and re-fetch the data
        pageNumber++;
        getData();
    });

    document.querySelector("#tableList").addEventListener("change", event => {
        // reset pageNumber to 0 to make it easier to work with
        // this needs to update the take and re-fetch the data
    pageNumber = 0;
    let perPage = document.querySelector('#tableList option:checked').value
    take = perPage;

    getData();
    });
    

    
</script>
</html>
